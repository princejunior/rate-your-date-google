{% extends "navbar.html" %}

{% block title %}
Chat
{% endblock %}

{% block content %}
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f2f2f2;
        display: flex;
        height: 100vh;
    }
    .sidebar {
        width: 250px;
        background-color: #333;
        color: #fff;
        padding: 20px;
    }
    .main-content {
        flex: 1;
        padding: 20px;
        overflow-y: scroll;
    }
    .chat-container {
        margin-bottom: 20px;
    }
    .message {
        background-color: #007bff;
        color: #ffffff;
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 10px;
        max-width: 70%;
    }
    .message.other {
        background-color: #e9e9e9;
        color: #000000;
        align-self: flex-start;
    }
    .message-input {
        margin-top: 20px;
    }
    .message-input form {
        display: flex;
    }
    .message-input input[type="text"] {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-right: 10px;
        font-size: 16px;
    }
    .message-input button {
        padding: 10px 20px;
        background-color: #007bff;
        color: #ffffff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }
</style>
{% comment %} {{user_conversations}} {% endcomment %}
<div class="sidebar" id="sidebar">
    <h2>Chats</h2>
    <ul id="chatList">
        {% for other_user_id in chat_with_other_user_id %}
            <li><a href="#" onclick="changeConversation('{{ other_user_id }}')">{{other_user_id}}</a></li>
        {% endfor %}

        <!-- Sidebar tabs will be dynamically populated here -->
        <li><a href="#" onclick="changeConversation('user1')">User 1</a></li>
        <li><a href="#" onclick="changeConversation('user2')">User 2</a></li>
        <li><a href="#" onclick="changeConversation('user3')">User 3</a></li>
        <!-- Add more users dynamically or fetch from database -->
    </ul>
</div>
{% comment %} {{chat_with_other_user_id}} {% endcomment %}
<div class="main-content">
    <div class="chat-container" id="chatContainer">
        {% for conversation in user_conversations %}
            {% for message in conversation %}
                {% if message.user_id == request.user.email %}
                    <div class="message">{{ message.message }}</div>
                {% else %}
                    <div class="message other">{{ message.message }}</div>
                {% endif %}    
                    {% comment %} <li>{{ message.time_stamp }} - {{ message.user_id }}: {{ message.message }}</li> {% endcomment %}
                {% endfor %}
        {% endfor %}
    </div>
    <div class="message-input">
        <form action="{% url 'send_message' %}" method="post">
            {% csrf_token %}
            <input type="text" name="message" id="messageInput" placeholder="Type your message" autocomplete="off">
            <input type="hidden" name="user_id" id="userId" value="123"> <!-- Replace '123' with the actual user ID -->
            <button type="submit">Send</button>
        </form>
    </div>
</div>
 
<script>
    function changeConversation(user) {
        // Fetch messages for the selected user (you need to implement this)
        // Update the chat container with the fetched messages
        // For now, just updating the user ID input field
        document.getElementById('userId').value = user;
    }
</script>
{% endblock %}
